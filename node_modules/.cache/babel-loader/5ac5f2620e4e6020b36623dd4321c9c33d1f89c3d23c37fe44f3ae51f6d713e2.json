{"ast":null,"code":"import _classCallCheck from \"C:/Users/barbu/Desktop/projeto-Akin/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/barbu/Desktop/projeto-Akin/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport EventEmitter from \"event-emitter\";\nimport { extend, borders, uuid, isNumber, bounds as _bounds, defer, createBlobUrl, revokeBlobUrl } from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\nvar IframeView = /*#__PURE__*/function () {\n  function IframeView(section, options) {\n    _classCallCheck(this, IframeView);\n    this.settings = extend({\n      ignoreClass: \"\",\n      axis: undefined,\n      //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n      direction: undefined,\n      width: 0,\n      height: 0,\n      layout: undefined,\n      globalLayoutProperties: {},\n      method: undefined,\n      forceRight: false,\n      allowScriptedContent: false,\n      allowPopups: false\n    }, options || {});\n    this.id = \"epubjs-view-\" + uuid();\n    this.section = section;\n    this.index = section.index;\n    this.element = this.container(this.settings.axis);\n    this.added = false;\n    this.displayed = false;\n    this.rendered = false;\n\n    // this.width  = this.settings.width;\n    // this.height = this.settings.height;\n\n    this.fixedWidth = 0;\n    this.fixedHeight = 0;\n\n    // Blank Cfi for Parsing\n    this.epubcfi = new EpubCFI();\n    this.layout = this.settings.layout;\n    // Dom events to listen for\n    // this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n    this.pane = undefined;\n    this.highlights = {};\n    this.underlines = {};\n    this.marks = {};\n  }\n  _createClass(IframeView, [{\n    key: \"container\",\n    value: function container(axis) {\n      var element = document.createElement(\"div\");\n      element.classList.add(\"epub-view\");\n\n      // this.element.style.minHeight = \"100px\";\n      element.style.height = \"0px\";\n      element.style.width = \"0px\";\n      element.style.overflow = \"hidden\";\n      element.style.position = \"relative\";\n      element.style.display = \"block\";\n      if (axis && axis == \"horizontal\") {\n        element.style.flex = \"none\";\n      } else {\n        element.style.flex = \"initial\";\n      }\n      return element;\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      if (this.iframe) {\n        return this.iframe;\n      }\n      if (!this.element) {\n        this.element = this.createContainer();\n      }\n      this.iframe = document.createElement(\"iframe\");\n      this.iframe.id = this.id;\n      this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n      this.iframe.style.overflow = \"hidden\";\n      this.iframe.seamless = \"seamless\";\n      // Back up if seamless isn't supported\n      this.iframe.style.border = \"none\";\n\n      // sandbox\n      this.iframe.sandbox = \"allow-same-origin\";\n      if (this.settings.allowScriptedContent) {\n        this.iframe.sandbox += \" allow-scripts\";\n      }\n      if (this.settings.allowPopups) {\n        this.iframe.sandbox += \" allow-popups\";\n      }\n      this.iframe.setAttribute(\"enable-annotation\", \"true\");\n      this.resizing = true;\n\n      // this.iframe.style.display = \"none\";\n      this.element.style.visibility = \"hidden\";\n      this.iframe.style.visibility = \"hidden\";\n      this.iframe.style.width = \"0\";\n      this.iframe.style.height = \"0\";\n      this._width = 0;\n      this._height = 0;\n      this.element.setAttribute(\"ref\", this.index);\n      this.added = true;\n      this.elementBounds = _bounds(this.element);\n\n      // if(width || height){\n      //   this.resize(width, height);\n      // } else if(this.width && this.height){\n      //   this.resize(this.width, this.height);\n      // } else {\n      //   this.iframeBounds = bounds(this.iframe);\n      // }\n\n      if (\"srcdoc\" in this.iframe) {\n        this.supportsSrcdoc = true;\n      } else {\n        this.supportsSrcdoc = false;\n      }\n      if (!this.settings.method) {\n        this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n      }\n      return this.iframe;\n    }\n  }, {\n    key: \"render\",\n    value: function render(request, show) {\n      // view.onLayout = this.layout.format.bind(this.layout);\n      this.create();\n\n      // Fit to size of the container, apply padding\n      this.size();\n      if (!this.sectionRender) {\n        this.sectionRender = this.section.render(request);\n      }\n\n      // Render Chain\n      return this.sectionRender.then(function (contents) {\n        return this.load(contents);\n      }.bind(this)).then(function () {\n        var _this = this;\n        // find and report the writingMode axis\n        var writingMode = this.contents.writingMode();\n\n        // Set the axis based on the flow and writing mode\n        var axis;\n        if (this.settings.flow === \"scrolled\") {\n          axis = writingMode.indexOf(\"vertical\") === 0 ? \"horizontal\" : \"vertical\";\n        } else {\n          axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n        }\n        if (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n          this.layout.delta = this.layout.height;\n        }\n        this.setAxis(axis);\n        this.emit(EVENTS.VIEWS.AXIS, axis);\n        this.setWritingMode(writingMode);\n        this.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\n\n        // apply the layout function to the contents\n        this.layout.format(this.contents, this.section, this.axis);\n\n        // Listen for events that require an expansion of the iframe\n        this.addListeners();\n        return new Promise(function (resolve, reject) {\n          // Expand the iframe to the full size of the content\n          _this.expand();\n          if (_this.settings.forceRight) {\n            _this.element.style.marginLeft = _this.width() + \"px\";\n          }\n          resolve();\n        });\n      }.bind(this), function (e) {\n        this.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n        return new Promise(function (resolve, reject) {\n          reject(e);\n        });\n      }.bind(this)).then(function () {\n        this.emit(EVENTS.VIEWS.RENDERED, this.section);\n      }.bind(this));\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      if (this.iframe) {\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n        this._textWidth = undefined;\n        this._contentWidth = undefined;\n        this._textHeight = undefined;\n        this._contentHeight = undefined;\n      }\n      this._needsReframe = true;\n    }\n\n    // Determine locks base on settings\n  }, {\n    key: \"size\",\n    value: function size(_width, _height) {\n      var width = _width || this.settings.width;\n      var height = _height || this.settings.height;\n      if (this.layout.name === \"pre-paginated\") {\n        this.lock(\"both\", width, height);\n      } else if (this.settings.axis === \"horizontal\") {\n        this.lock(\"height\", width, height);\n      } else {\n        this.lock(\"width\", width, height);\n      }\n      this.settings.width = width;\n      this.settings.height = height;\n    }\n\n    // Lock an axis to element dimensions, taking borders into account\n  }, {\n    key: \"lock\",\n    value: function lock(what, width, height) {\n      var elBorders = borders(this.element);\n      var iframeBorders;\n      if (this.iframe) {\n        iframeBorders = borders(this.iframe);\n      } else {\n        iframeBorders = {\n          width: 0,\n          height: 0\n        };\n      }\n      if (what == \"width\" && isNumber(width)) {\n        this.lockedWidth = width - elBorders.width - iframeBorders.width;\n        // this.resize(this.lockedWidth, width); //  width keeps ratio correct\n      }\n\n      if (what == \"height\" && isNumber(height)) {\n        this.lockedHeight = height - elBorders.height - iframeBorders.height;\n        // this.resize(width, this.lockedHeight);\n      }\n\n      if (what === \"both\" && isNumber(width) && isNumber(height)) {\n        this.lockedWidth = width - elBorders.width - iframeBorders.width;\n        this.lockedHeight = height - elBorders.height - iframeBorders.height;\n        // this.resize(this.lockedWidth, this.lockedHeight);\n      }\n\n      if (this.displayed && this.iframe) {\n        // this.contents.layout();\n        this.expand();\n      }\n    }\n\n    // Resize a single axis based on content dimensions\n  }, {\n    key: \"expand\",\n    value: function expand(force) {\n      var width = this.lockedWidth;\n      var height = this.lockedHeight;\n      var columns;\n      var textWidth, textHeight;\n      if (!this.iframe || this._expanding) return;\n      this._expanding = true;\n      if (this.layout.name === \"pre-paginated\") {\n        width = this.layout.columnWidth;\n        height = this.layout.height;\n      }\n      // Expand Horizontally\n      else if (this.settings.axis === \"horizontal\") {\n        // Get the width of the text\n        width = this.contents.textWidth();\n        if (width % this.layout.pageWidth > 0) {\n          width = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n        }\n        if (this.settings.forceEvenPages) {\n          columns = width / this.layout.pageWidth;\n          if (this.layout.divisor > 1 && this.layout.name === \"reflowable\" && columns % 2 > 0) {\n            // add a blank page\n            width += this.layout.pageWidth;\n          }\n        }\n      } // Expand Vertically\n      else if (this.settings.axis === \"vertical\") {\n        height = this.contents.textHeight();\n        if (this.settings.flow === \"paginated\" && height % this.layout.height > 0) {\n          height = Math.ceil(height / this.layout.height) * this.layout.height;\n        }\n      }\n\n      // Only Resize if dimensions have changed or\n      // if Frame is still hidden, so needs reframing\n      if (this._needsReframe || width != this._width || height != this._height) {\n        this.reframe(width, height);\n      }\n      this._expanding = false;\n    }\n  }, {\n    key: \"reframe\",\n    value: function reframe(width, height) {\n      var _this2 = this;\n      var size;\n      if (isNumber(width)) {\n        this.element.style.width = width + \"px\";\n        this.iframe.style.width = width + \"px\";\n        this._width = width;\n      }\n      if (isNumber(height)) {\n        this.element.style.height = height + \"px\";\n        this.iframe.style.height = height + \"px\";\n        this._height = height;\n      }\n      var widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n      var heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n      size = {\n        width: width,\n        height: height,\n        widthDelta: widthDelta,\n        heightDelta: heightDelta\n      };\n      this.pane && this.pane.render();\n      requestAnimationFrame(function () {\n        var mark;\n        for (var m in _this2.marks) {\n          if (_this2.marks.hasOwnProperty(m)) {\n            mark = _this2.marks[m];\n            _this2.placeMark(mark.element, mark.range);\n          }\n        }\n      });\n      this.onResize(this, size);\n      this.emit(EVENTS.VIEWS.RESIZED, size);\n      this.prevBounds = size;\n      this.elementBounds = _bounds(this.element);\n    }\n  }, {\n    key: \"load\",\n    value: function load(contents) {\n      var loading = new defer();\n      var loaded = loading.promise;\n      if (!this.iframe) {\n        loading.reject(new Error(\"No Iframe Available\"));\n        return loaded;\n      }\n      this.iframe.onload = function (event) {\n        this.onLoad(event, loading);\n      }.bind(this);\n      if (this.settings.method === \"blobUrl\") {\n        this.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n        this.iframe.src = this.blobUrl;\n        this.element.appendChild(this.iframe);\n      } else if (this.settings.method === \"srcdoc\") {\n        this.iframe.srcdoc = contents;\n        this.element.appendChild(this.iframe);\n      } else {\n        this.element.appendChild(this.iframe);\n        this.document = this.iframe.contentDocument;\n        if (!this.document) {\n          loading.reject(new Error(\"No Document Available\"));\n          return loaded;\n        }\n        this.iframe.contentDocument.open();\n        // For Cordova windows platform\n        if (window.MSApp && MSApp.execUnsafeLocalFunction) {\n          var outerThis = this;\n          MSApp.execUnsafeLocalFunction(function () {\n            outerThis.iframe.contentDocument.write(contents);\n          });\n        } else {\n          this.iframe.contentDocument.write(contents);\n        }\n        this.iframe.contentDocument.close();\n      }\n      return loaded;\n    }\n  }, {\n    key: \"onLoad\",\n    value: function onLoad(event, promise) {\n      var _this3 = this;\n      this.window = this.iframe.contentWindow;\n      this.document = this.iframe.contentDocument;\n      this.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n      this.rendering = false;\n      var link = this.document.querySelector(\"link[rel='canonical']\");\n      if (link) {\n        link.setAttribute(\"href\", this.section.canonical);\n      } else {\n        link = this.document.createElement(\"link\");\n        link.setAttribute(\"rel\", \"canonical\");\n        link.setAttribute(\"href\", this.section.canonical);\n        this.document.querySelector(\"head\").appendChild(link);\n      }\n      this.contents.on(EVENTS.CONTENTS.EXPAND, function () {\n        if (_this3.displayed && _this3.iframe) {\n          _this3.expand();\n          if (_this3.contents) {\n            _this3.layout.format(_this3.contents);\n          }\n        }\n      });\n      this.contents.on(EVENTS.CONTENTS.RESIZE, function (e) {\n        if (_this3.displayed && _this3.iframe) {\n          _this3.expand();\n          if (_this3.contents) {\n            _this3.layout.format(_this3.contents);\n          }\n        }\n      });\n      promise.resolve(this.contents);\n    }\n  }, {\n    key: \"setLayout\",\n    value: function setLayout(layout) {\n      this.layout = layout;\n      if (this.contents) {\n        this.layout.format(this.contents);\n        this.expand();\n      }\n    }\n  }, {\n    key: \"setAxis\",\n    value: function setAxis(axis) {\n      this.settings.axis = axis;\n      if (axis == \"horizontal\") {\n        this.element.style.flex = \"none\";\n      } else {\n        this.element.style.flex = \"initial\";\n      }\n      this.size();\n    }\n  }, {\n    key: \"setWritingMode\",\n    value: function setWritingMode(mode) {\n      // this.element.style.writingMode = writingMode;\n      this.writingMode = mode;\n    }\n  }, {\n    key: \"addListeners\",\n    value: function addListeners() {\n      //TODO: Add content listeners for expanding\n    }\n  }, {\n    key: \"removeListeners\",\n    value: function removeListeners(layoutFunc) {\n      //TODO: remove content listeners for expanding\n    }\n  }, {\n    key: \"display\",\n    value: function display(request) {\n      var displayed = new defer();\n      if (!this.displayed) {\n        this.render(request).then(function () {\n          this.emit(EVENTS.VIEWS.DISPLAYED, this);\n          this.onDisplayed(this);\n          this.displayed = true;\n          displayed.resolve(this);\n        }.bind(this), function (err) {\n          displayed.reject(err, this);\n        });\n      } else {\n        displayed.resolve(this);\n      }\n      return displayed.promise;\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.element.style.visibility = \"visible\";\n      if (this.iframe) {\n        this.iframe.style.visibility = \"visible\";\n\n        // Remind Safari to redraw the iframe\n        this.iframe.style.transform = \"translateZ(0)\";\n        this.iframe.offsetWidth;\n        this.iframe.style.transform = null;\n      }\n      this.emit(EVENTS.VIEWS.SHOWN, this);\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      // this.iframe.style.display = \"none\";\n      this.element.style.visibility = \"hidden\";\n      this.iframe.style.visibility = \"hidden\";\n      this.stopExpanding = true;\n      this.emit(EVENTS.VIEWS.HIDDEN, this);\n    }\n  }, {\n    key: \"offset\",\n    value: function offset() {\n      return {\n        top: this.element.offsetTop,\n        left: this.element.offsetLeft\n      };\n    }\n  }, {\n    key: \"width\",\n    value: function width() {\n      return this._width;\n    }\n  }, {\n    key: \"height\",\n    value: function height() {\n      return this._height;\n    }\n  }, {\n    key: \"position\",\n    value: function position() {\n      return this.element.getBoundingClientRect();\n    }\n  }, {\n    key: \"locationOf\",\n    value: function locationOf(target) {\n      var parentPos = this.iframe.getBoundingClientRect();\n      var targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n      return {\n        \"left\": targetPos.left,\n        \"top\": targetPos.top\n      };\n    }\n  }, {\n    key: \"onDisplayed\",\n    value: function onDisplayed(view) {\n      // Stub, override with a custom functions\n    }\n  }, {\n    key: \"onResize\",\n    value: function onResize(view, e) {\n      // Stub, override with a custom functions\n    }\n  }, {\n    key: \"bounds\",\n    value: function bounds(force) {\n      if (force || !this.elementBounds) {\n        this.elementBounds = _bounds(this.element);\n      }\n      return this.elementBounds;\n    }\n  }, {\n    key: \"highlight\",\n    value: function highlight(cfiRange) {\n      var _this4 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      var className = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"epubjs-hl\";\n      var styles = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      if (!this.contents) {\n        return;\n      }\n      var attributes = Object.assign({\n        \"fill\": \"yellow\",\n        \"fill-opacity\": \"0.3\",\n        \"mix-blend-mode\": \"multiply\"\n      }, styles);\n      var range = this.contents.range(cfiRange);\n      var emitter = function emitter() {\n        _this4.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      data[\"epubcfi\"] = cfiRange;\n      if (!this.pane) {\n        this.pane = new Pane(this.iframe, this.element);\n      }\n      var m = new Highlight(range, className, data, attributes);\n      var h = this.pane.addMark(m);\n      this.highlights[cfiRange] = {\n        \"mark\": h,\n        \"element\": h.element,\n        \"listeners\": [emitter, cb]\n      };\n      h.element.setAttribute(\"ref\", className);\n      h.element.addEventListener(\"click\", emitter);\n      h.element.addEventListener(\"touchstart\", emitter);\n      if (cb) {\n        h.element.addEventListener(\"click\", cb);\n        h.element.addEventListener(\"touchstart\", cb);\n      }\n      return h;\n    }\n  }, {\n    key: \"underline\",\n    value: function underline(cfiRange) {\n      var _this5 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      var className = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"epubjs-ul\";\n      var styles = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      if (!this.contents) {\n        return;\n      }\n      var attributes = Object.assign({\n        \"stroke\": \"black\",\n        \"stroke-opacity\": \"0.3\",\n        \"mix-blend-mode\": \"multiply\"\n      }, styles);\n      var range = this.contents.range(cfiRange);\n      var emitter = function emitter() {\n        _this5.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      data[\"epubcfi\"] = cfiRange;\n      if (!this.pane) {\n        this.pane = new Pane(this.iframe, this.element);\n      }\n      var m = new Underline(range, className, data, attributes);\n      var h = this.pane.addMark(m);\n      this.underlines[cfiRange] = {\n        \"mark\": h,\n        \"element\": h.element,\n        \"listeners\": [emitter, cb]\n      };\n      h.element.setAttribute(\"ref\", className);\n      h.element.addEventListener(\"click\", emitter);\n      h.element.addEventListener(\"touchstart\", emitter);\n      if (cb) {\n        h.element.addEventListener(\"click\", cb);\n        h.element.addEventListener(\"touchstart\", cb);\n      }\n      return h;\n    }\n  }, {\n    key: \"mark\",\n    value: function mark(cfiRange) {\n      var _this6 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      if (!this.contents) {\n        return;\n      }\n      if (cfiRange in this.marks) {\n        var item = this.marks[cfiRange];\n        return item;\n      }\n      var range = this.contents.range(cfiRange);\n      if (!range) {\n        return;\n      }\n      var container = range.commonAncestorContainer;\n      var parent = container.nodeType === 1 ? container : container.parentNode;\n      var emitter = function emitter(e) {\n        _this6.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      if (range.collapsed && container.nodeType === 1) {\n        range = new Range();\n        range.selectNodeContents(container);\n      } else if (range.collapsed) {\n        // Webkit doesn't like collapsed ranges\n        range = new Range();\n        range.selectNodeContents(parent);\n      }\n      var mark = this.document.createElement(\"a\");\n      mark.setAttribute(\"ref\", \"epubjs-mk\");\n      mark.style.position = \"absolute\";\n      mark.dataset[\"epubcfi\"] = cfiRange;\n      if (data) {\n        Object.keys(data).forEach(function (key) {\n          mark.dataset[key] = data[key];\n        });\n      }\n      if (cb) {\n        mark.addEventListener(\"click\", cb);\n        mark.addEventListener(\"touchstart\", cb);\n      }\n      mark.addEventListener(\"click\", emitter);\n      mark.addEventListener(\"touchstart\", emitter);\n      this.placeMark(mark, range);\n      this.element.appendChild(mark);\n      this.marks[cfiRange] = {\n        \"element\": mark,\n        \"range\": range,\n        \"listeners\": [emitter, cb]\n      };\n      return parent;\n    }\n  }, {\n    key: \"placeMark\",\n    value: function placeMark(element, range) {\n      var top, right, left;\n      if (this.layout.name === \"pre-paginated\" || this.settings.axis !== \"horizontal\") {\n        var pos = range.getBoundingClientRect();\n        top = pos.top;\n        right = pos.right;\n      } else {\n        // Element might break columns, so find the left most element\n        var rects = range.getClientRects();\n        var rect;\n        for (var i = 0; i != rects.length; i++) {\n          rect = rects[i];\n          if (!left || rect.left < left) {\n            left = rect.left;\n            // right = rect.right;\n            right = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - this.layout.gap / 2;\n            top = rect.top;\n          }\n        }\n      }\n      element.style.top = \"\".concat(top, \"px\");\n      element.style.left = \"\".concat(right, \"px\");\n    }\n  }, {\n    key: \"unhighlight\",\n    value: function unhighlight(cfiRange) {\n      var item;\n      if (cfiRange in this.highlights) {\n        item = this.highlights[cfiRange];\n        this.pane.removeMark(item.mark);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.highlights[cfiRange];\n      }\n    }\n  }, {\n    key: \"ununderline\",\n    value: function ununderline(cfiRange) {\n      var item;\n      if (cfiRange in this.underlines) {\n        item = this.underlines[cfiRange];\n        this.pane.removeMark(item.mark);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.underlines[cfiRange];\n      }\n    }\n  }, {\n    key: \"unmark\",\n    value: function unmark(cfiRange) {\n      var item;\n      if (cfiRange in this.marks) {\n        item = this.marks[cfiRange];\n        this.element.removeChild(item.element);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.marks[cfiRange];\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      for (var cfiRange in this.highlights) {\n        this.unhighlight(cfiRange);\n      }\n      for (var _cfiRange in this.underlines) {\n        this.ununderline(_cfiRange);\n      }\n      for (var _cfiRange2 in this.marks) {\n        this.unmark(_cfiRange2);\n      }\n      if (this.blobUrl) {\n        revokeBlobUrl(this.blobUrl);\n      }\n      if (this.displayed) {\n        this.displayed = false;\n        this.removeListeners();\n        this.contents.destroy();\n        this.stopExpanding = true;\n        this.element.removeChild(this.iframe);\n        if (this.pane) {\n          this.pane.element.remove();\n          this.pane = undefined;\n        }\n        this.iframe = undefined;\n        this.contents = undefined;\n        this._textWidth = null;\n        this._textHeight = null;\n        this._width = null;\n        this._height = null;\n      }\n\n      // this.element.style.height = \"0px\";\n      // this.element.style.width = \"0px\";\n    }\n  }]);\n  return IframeView;\n}();\nEventEmitter(IframeView.prototype);\nexport default IframeView;","map":{"version":3,"names":["EventEmitter","extend","borders","uuid","isNumber","bounds","defer","createBlobUrl","revokeBlobUrl","EpubCFI","Contents","EVENTS","Pane","Highlight","Underline","IframeView","section","options","_classCallCheck","settings","ignoreClass","axis","undefined","direction","width","height","layout","globalLayoutProperties","method","forceRight","allowScriptedContent","allowPopups","id","index","element","container","added","displayed","rendered","fixedWidth","fixedHeight","epubcfi","pane","highlights","underlines","marks","_createClass","key","value","document","createElement","classList","add","style","overflow","position","display","flex","create","iframe","createContainer","scrolling","seamless","border","sandbox","setAttribute","resizing","visibility","_width","_height","elementBounds","supportsSrcdoc","render","request","show","size","sectionRender","then","contents","load","bind","_this","writingMode","flow","indexOf","delta","setAxis","emit","VIEWS","AXIS","setWritingMode","WRITING_MODE","format","addListeners","Promise","resolve","reject","expand","marginLeft","e","LOAD_ERROR","RENDERED","reset","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","name","lock","what","elBorders","iframeBorders","lockedWidth","lockedHeight","force","columns","textWidth","textHeight","_expanding","columnWidth","pageWidth","Math","ceil","forceEvenPages","divisor","reframe","_this2","widthDelta","prevBounds","heightDelta","requestAnimationFrame","mark","m","hasOwnProperty","placeMark","range","onResize","RESIZED","loading","loaded","promise","Error","onload","event","onLoad","blobUrl","src","appendChild","srcdoc","contentDocument","open","window","MSApp","execUnsafeLocalFunction","outerThis","write","close","_this3","contentWindow","body","cfiBase","rendering","link","querySelector","canonical","on","CONTENTS","EXPAND","RESIZE","setLayout","mode","removeListeners","layoutFunc","DISPLAYED","onDisplayed","err","transform","offsetWidth","SHOWN","hide","stopExpanding","HIDDEN","offset","top","offsetTop","left","offsetLeft","getBoundingClientRect","locationOf","target","parentPos","targetPos","view","highlight","cfiRange","_this4","data","arguments","length","cb","className","styles","attributes","Object","assign","emitter","MARK_CLICKED","h","addMark","addEventListener","underline","_this5","_this6","item","commonAncestorContainer","parent","nodeType","parentNode","collapsed","Range","selectNodeContents","dataset","keys","forEach","right","pos","rects","getClientRects","rect","i","props","gap","concat","unhighlight","removeMark","listeners","l","removeEventListener","ununderline","unmark","removeChild","destroy","remove","prototype"],"sources":["C:/Users/barbu/Desktop/projeto-Akin/node_modules/epubjs/src/managers/views/iframe.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: undefined, //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined,\n\t\t\tforceRight: false,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\t// sandbox\n\t\tthis.iframe.sandbox = \"allow-same-origin\";\n\t\tif (this.settings.allowScriptedContent) {\n\t\t\tthis.iframe.sandbox += \" allow-scripts\";\n\t\t}\n\t\tif (this.settings.allowPopups) {\n\t\t\tthis.iframe.sandbox += \" allow-popups\";\n\t\t}\n\t\t\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\n\t\t\t\t// Set the axis based on the flow and writing mode\n\t\t\t\tlet axis;\n\t\t\t\tif (this.settings.flow === \"scrolled\") {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"horizontal\" : \"vertical\";\n\t\t\t\t} else {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\t\t\t\t}\n\n\t\t\t\tif (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n\t\t\t\t\tthis.layout.delta = this.layout.height;\n\t\t\t\t}\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\t\t\t\tthis.setWritingMode(writingMode);\n\t\t\t\tthis.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\n\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.layout.format(this.contents, this.section, this.axis);\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\n\t\t\t\t\tif (this.settings.forceRight) {\n\t\t\t\t\t\tthis.element.style.marginLeft = this.width() + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t\tif (this.settings.flow === \"paginated\" &&\n\t\t\t\theight % this.layout.height > 0) {\n\t\t\t\theight = Math.ceil(height / this.layout.height) * this.layout.height;\n\t\t\t}\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\t// For Cordova windows platform\n\t\t\tif(window.MSApp && MSApp.execUnsafeLocalFunction) {\n\t\t\t\tvar outerThis = this;\n\t\t\t\tMSApp.execUnsafeLocalFunction(function () {\n\t\t\t\t\touterThis.iframe.contentDocument.write(contents);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\t}\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\tsetWritingMode(mode) {\n\t\t// this.element.style.writingMode = writingMode;\n\t\tthis.writingMode = mode;\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\t// right = rect.right;\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\t\t\tthis.contents.destroy();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tif (this.pane) {\n\t\t\t\tthis.pane.element.remove();\n\t\t\t\tthis.pane = undefined;\n\t\t\t}\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}